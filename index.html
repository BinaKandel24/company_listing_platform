<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Company Listing Platform</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: #f4f4f4;
  }

  header {
    background-color: #333;
    color: white;
    padding: 15px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  header .logo {
    font-size: 20px;
    font-weight: bold;
  }

  nav a {
    color: white;
    text-decoration: none;
    margin: 0 15px;
    font-size: 16px;
  }

  .search-box input {
    padding: 6px;
    border-radius: 4px;
    border: none;
  }

  .container {
    padding: 30px;
  }

  h2 {
    text-align: center;
    margin-bottom: 30px;
  }

  .company-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
  }

  .company-card {
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    transition: 0.3s ease;
    cursor: pointer;
    position: relative;
  }

  .company-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  }

  .company-card h3 {
    margin-top: 0;
    color: #333;
  }

  .rating {
    color: #f5a623;
    font-size: 18px;
  }

  .filter-section {
    max-width: 600px;
    margin: 0 auto 30px auto;
    display: flex;
    justify-content: space-between;
    gap: 15px;
    flex-wrap: wrap;
  }

  select, .search-box input {
    flex: 1 1 200px;
  }

  #addCompanyBtn {
    display: none;
    margin-bottom: 30px;
    padding: 12px 20px;
    font-size: 16px;
    background-color: #28a745;
    border: none;
    color: white;
    border-radius: 6px;
    cursor: pointer;
  }
  #addCompanyBtn:hover {
    background-color: #218838;
  }

  .edit-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 6px 10px;
    cursor: pointer;
    font-size: 12px;
  }
  .edit-btn:hover {
    background-color: #0056b3;
  }

  #logoutBtn {
    background: #dc3545;
    border: none;
    padding: 10px 15px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    color: white;
  }
  #logoutBtn:hover {
    background: #b02a37;
  }

  footer {
    background-color: #333;
    color: white;
    text-align: center;
    padding: 20px;
    margin-top: 50px;
  }

  @media screen and (max-width: 600px) {
    nav {
      display: none;
    }
    .filter-section {
      flex-direction: column;
    }
    select, .search-box input {
      flex: 1 1 auto;
    }
  }
</style>
</head>
<body>

<header>
  <div class="logo">[Co. Logo]</div>
  <nav>
    <!-- Removed Home tab as per request -->
    <a href="#">Products</a>
    <a href="#">Services</a>
    <a href="#">Contact</a>
  </nav>
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="Search..." />
  </div>
  <button id="logoutBtn">Logout</button>
</header>

<div class="container">
  <h2>Featured Companies</h2>

  <div class="filter-section">
    <select id="categoryFilter">
      <option value="">All Categories</option>
      <option value="food">Food</option>
      <option value="clothing">Clothing</option>
      <option value="tech">Tech</option>
    </select>
    <button id="addCompanyBtn">Add New Company</button>
  </div>

  <div class="company-grid" id="companyGrid">
    <!-- Company cards go here -->
  </div>
</div>

<footer>
  &copy; 2025 Company Listing Platform. All rights reserved.
</footer>

<script>
  const companyGrid = document.getElementById('companyGrid');
  const categoryFilter = document.getElementById('categoryFilter');
  const searchInput = document.getElementById('searchInput');
  const addCompanyBtn = document.getElementById('addCompanyBtn');
  const logoutBtn = document.getElementById('logoutBtn');

  // Redirect to login if no userType set
  if (!localStorage.getItem('userType')) {
    window.location.href = 'login.html';
  }

  const userType = localStorage.getItem('userType');

  if (userType === 'owner') {
    addCompanyBtn.style.display = 'inline-block';
  } else {
    addCompanyBtn.style.display = 'none';
  }

  logoutBtn.onclick = () => {
    localStorage.removeItem('userType');
    window.location.href = 'login.html';
  };

  function getCompanies() {
    const stored = localStorage.getItem('companies');
    return stored ? JSON.parse(stored) : [];
  }

  function saveCompanies(companies) {
    localStorage.setItem('companies', JSON.stringify(companies));
  }

  function renderStars(num) {
    return '★'.repeat(num) + '☆'.repeat(5 - num);
  }

  function capitalize(str) {
    if (!str) return '';
    return str.charAt(0).toUpperCase() + str.slice(1);
  }

  function renderCompanies(companies) {
    companyGrid.innerHTML = '';
    if (companies.length === 0) {
      companyGrid.innerHTML = '<p style="grid-column:1/-1; text-align:center;">No companies found.</p>';
      return;
    }
    companies.forEach(company => {
      const card = document.createElement('div');
      card.className = 'company-card';

      const avgRating = company.ratingsCount === 0 ? 0 : Math.round(company.rating);

      card.innerHTML = `
        <h3>${company.name}</h3>
        <p><strong>Address:</strong> ${company.address}</p>
        <p><strong>Info:</strong> ${company.info}</p>
        <p><strong>Category:</strong> ${capitalize(company.category)}</p>
        <p><strong>Contact:</strong> ${company.contact}</p>
        <p class="rating">Rating: ${renderStars(avgRating)} (${company.ratingsCount} reviews)</p>
      `;

      card.onclick = (e) => {
        // Prevent click when edit button clicked
        if (e.target.classList.contains('edit-btn')) return;
        window.location.href = `company.html?id=${company.id}`;
      };

      if (userType === 'owner') {
        const editBtn = document.createElement('button');
        editBtn.textContent = 'Edit';
        editBtn.className = 'edit-btn';
        editBtn.onclick = (e) => {
          e.stopPropagation();
          window.location.href = `add_company.html?id=${company.id}`;
        };
        card.appendChild(editBtn);
      }

      companyGrid.appendChild(card);
    });
  }

  function filterAndRender() {
    const companies = getCompanies();
    const cat = categoryFilter.value.toLowerCase();
    const search = searchInput.value.toLowerCase();

    const filtered = companies.filter(c => {
      const matchesCategory = cat === '' || c.category.toLowerCase() === cat;
      const matchesSearch =
        c.name.toLowerCase().includes(search) ||
        c.info.toLowerCase().includes(search) ||
        c.address.toLowerCase().includes(search) ||
        c.contact.toLowerCase().includes(search);
      return matchesCategory && matchesSearch;
    });

    renderCompanies(filtered);
  }

  addCompanyBtn.onclick = () => {
    window.location.href = 'add_company.html';
  };

  categoryFilter.onchange = filterAndRender;
  searchInput.oninput = filterAndRender;

  // Initial render
  filterAndRender();
</script>

</body>
</html>
